<form [formGroup]="strategyForm" #strategyFormRef (ngSubmit)="onSubmit(strategyForm.value)" class="form-horizontal" method="post">
    <c-row>
        <c-col sm="12">
            <c-card>
                <c-card-header>
                    <strong *ngIf="isEdit">Update Strategy</strong>
                    <strong *ngIf="!isEdit">Create Strategy</strong>
                </c-card-header>
                <c-card-body>
                    <c-row>
                        <!--                        Is Active CHECKBOX-->
                        <c-form-group cCol sm="1">
                            <label for="isActive">Is Active?</label>
                            <c-form-check variant="checkbox">
                                <input cInput type="checkbox" value="option1" id="isActive" formControlName="isActive">
                            </c-form-check>
                        </c-form-group>

                        <!--                        STRATEGY ID-->
                        <c-form-group cCol sm="5">
                            <label cLabel="col" cCol md="4" for="input1-group1">Strategy Id </label>
                            <c-input-group>
                                <c-input-group-prepend>
                                    <c-input-group-text>
                                        <c-icon name="cil-lightbulb"></c-icon>
                                    </c-input-group-text>
                                </c-input-group-prepend>
                                <input cInput id="input1-group1"
                                       name="input1-group1"
                                       placeholder="Strategy Id (Cannot be changed after creation)"
                                       formControlName="strategyId"
                                       max="30"
                                       [attr.disabled]="isEdit"
                                       (change)="restoreStrategyId()"
                                       [ngClass]="{ 'is-invalid':  (submitted || ctrls.strategyId.touched) && ctrls.strategyId.invalid, 'is-valid': ctrls.strategyId.touched && ctrls.strategyId.valid }">
                            </c-input-group>
                            <div *ngIf="strategyForm.get('strategyId').errors?.required && !strategyForm.get('strategyId').pristine" class="alert alert-danger">
                                Strategy Id is required
                            </div>
                            <div *ngIf="strategyForm.get('strategyId').errors?.pattern && !strategyForm.get('strategyId').pristine" class="alert alert-danger">
                                Strategy Id can contain only numbers, letters, - and _ characters.
                            </div>
                            <div *ngIf="strategyForm.get('strategyId').errors?.minlength && !strategyForm.get('strategyId').pristine" class="alert alert-danger">
                                Strategy Id must be at least 3 characters.
                            </div>
                            <div *ngIf="strategyForm.get('strategyId').errors?.maxlength && !strategyForm.get('strategyId').pristine" class="alert alert-danger">
                                Strategy Id must be maximum 30 characters.
                            </div>
                            <div *ngIf="strategyForm.get('strategyId').errors?.srategyIdExists && !strategyForm.get('strategyId').pristine" class="alert alert-danger">
                                Strategy Id must be unique
                            </div>
                        </c-form-group>

                        <!--                        STRATEGY DESCRIPTION-->
                        <c-form-group cCol sm="6">
                            <label for="strategyDescription">Strategy Description</label>
                            <c-input-group>
                                <c-input-group-prepend>
                                    <c-input-group-text>
                                        <c-icon name="cil-description"></c-icon>
                                    </c-input-group-text>
                                </c-input-group-prepend>
                                <textarea cTextarea id="strategyDescription"
                                          name="strategyDescription" rows="7"
                                          placeholder="Strategy Description"
                                          formControlName="strategyDesc"
                                          [ngClass]="{ 'is-invalid':  (submitted || ctrls.strategyId.touched) && ctrls.strategyDesc.invalid, 'is-valid': ctrls.strategyDesc.touched && ctrls.strategyDesc.valid }">

                                        </textarea>
                                <div *ngIf="strategyForm.get('strategyDesc').errors?.required && !strategyForm.get('strategyDesc').pristine" class="alert alert-danger">
                                    Strategy Description is required
                                </div>
                            </c-input-group>
                        </c-form-group>
                    </c-row>
    <!--                        STOP LOSS PERCENT-->
                        <c-form-group cRow>
                            <c-form-group cCol>
                                <label cLabel="col" cCol md="3" for="input2-group1">Stop Loss Percent</label>
                                <c-col md="12">
                                    <c-input-group>
                                        <input cInput id="input2-group1"
                                               name="input2-group1"
                                               placeholder="Stop Loss Percent"
                                               formControlName="stopLossPerc"
                                               type="number"
                                               step="1"
                                               [ngClass]="{ 'is-invalid':  (submitted || ctrls.stopLossPerc.touched) && ctrls.stopLossPerc.invalid, 'is-valid': ctrls.stopLossPerc.touched && ctrls.stopLossPerc.valid }">
                                        <c-input-group-append>
                                            <c-input-group-text>%</c-input-group-text>
                                        </c-input-group-append>
                                    </c-input-group>
                                    <div *ngIf="strategyForm.get('stopLossPerc').errors?.required && !strategyForm.get('stopLossPerc').pristine" class="alert alert-danger">
                                        Stop Loss Percent is required
                                    </div>
                                </c-col>
                            </c-form-group>
                            <!--                        TAKE PROFIT PERCENT-->
                            <c-form-group cCol>
                                <label cLabel="col" cCol md="3" for="input4-group1">Take Profit Percent</label>
                                <c-col md="12">
                                    <c-input-group>
                                        <input cInput
                                               id="input4-group1"
                                               name="input4-group1"
                                               placeholder="Take Profit Percent"
                                               formControlName="takeProfitPerc"
                                               type="number"
                                               step="1"
                                               [ngClass]="{ 'is-invalid':  (submitted || ctrls.takeProfitPerc.touched) && ctrls.takeProfitPerc.invalid, 'is-valid': ctrls.takeProfitPerc.touched && ctrls.takeProfitPerc.valid }">
                                        <c-input-group-append>
                                            <c-input-group-text>%</c-input-group-text>
                                        </c-input-group-append>
                                    </c-input-group>
                                    <div *ngIf="strategyForm.get('takeProfitPerc').errors?.required && !strategyForm.get('takeProfitPerc').pristine" class="alert alert-danger">
                                        Take Profit Percent is required
                                    </div>
                                </c-col>
                            </c-form-group>
    <!--                    TRAILING STOP LOSS PERCENT-->
                            <c-form-group cCol>
                                <label cLabel="col" cCol md="3" for="input3-group1">Trailing Stop Loss Percent</label>
                                <c-col md="12">
                                    <c-input-group>
                                        <input cInput id="input3-group1"
                                               name="input3-group1"
                                               placeholder="Trailing Stop Loss Percent"
                                               formControlName="trailingStopPerc"
                                               type="number"
                                               step="1">
                                        <c-input-group-append>
                                            <c-input-group-text>%</c-input-group-text>
                                        </c-input-group-append>
                                    </c-input-group>
                                </c-col>
                            </c-form-group>

    <!--                    MAX DOLLAR AMOUNT -->
                            <c-form-group cCol>
                                <label cLabel="col" cCol md="3" for="input5-group1">Max Dollar Amount</label>
                                <c-col md="12">
                                    <c-input-group>
                                        <c-input-group-prepend>
                                            <c-input-group-text>
                                                <c-icon name="cil-dollar"></c-icon>
                                            </c-input-group-text>
                                        </c-input-group-prepend>
                                        <input cInput id="input5-group1"
                                               name="input5-group1"
                                               placeholder="Max Dollar Amount"
                                               formControlName="maxDollarAmount"
                                                type="number"
                                                step="100"[ngClass]="{ 'is-invalid':  (submitted || ctrls.maxDollarAmount.touched) && ctrls.maxDollarAmount.invalid, 'is-valid': ctrls.maxDollarAmount.touched && ctrls.maxDollarAmount.valid }">
                                    </c-input-group>
                                    <div *ngIf="strategyForm.get('maxDollarAmount').errors?.required && !strategyForm.get('maxDollarAmount').pristine" class="alert alert-danger">
                                        Max Dollar Amount is required
                                    </div>
                                </c-col>
                            </c-form-group>

                        </c-form-group>

                        <hr class="mt-0">
    <!--                    IS ONLY BULLISH-->
                        <c-form-group cRow>
                            <c-form-group cCol>
                                <label cLabel="col" cCol md="3">Is Only Bullish?</label>
                                <c-col md="9" col="form-label">
                                    <c-form-check variant="checkbox">
                                        <input cInput type="checkbox" value="option1" id="isOnlyBullish" formControlName="isOnlyBullish" (click)="isBullishClicked($event)">
                                    </c-form-check>
                                </c-col>
                            </c-form-group>
    <!--                        IS ONLY BEARISH-->
                            <c-form-group cCol>
                                <label cLabel="col" cCol md="3">Is Only Bearish?</label>
                                <c-col md="9" col="form-label">
                                    <c-form-check variant="checkbox">
                                        <input cInput type="checkbox" value="option1" id="isOnlyBearish" formControlName="isOnlyBearish" (click)="isBearishClicked($event)">
                                    </c-form-check>
                                </c-col>
                            </c-form-group>
    <!--                        IS ONLY BEARISH-->
                            <c-form-group cCol>
                                <label cLabel="col" cCol md="3">Is Both Way?</label>
                                <c-col md="9" col="form-label">
                                    <c-form-check variant="checkbox">
                                        <input cInput type="checkbox" value="option1" id="isBothWay" formControlName="isBothWay" (click)="isBothClicked($event)">
                                    </c-form-check>
                                </c-col>
                            </c-form-group>
                        </c-form-group>

                </c-card-body>
            </c-card>
        </c-col>
    </c-row>
    <c-row>
        <c-col sm="12">
            <c-card>
                <c-card-header>
                    <strong>Bullish conditions</strong>
                </c-card-header>
                <c-card-body>
                    <ng-container formArrayName="bullishConditions">
                        <ng-container *ngFor="let bullishConditionItem of bullishConditions.controls; let i = index">
                            <c-row [formGroup]="bullishConditionItem">
                                <!--                       BULLISH CONDITION STATUS;-->
                                <c-form-group cCol sm="1">
                                    <label for="condition">Status</label>
                                    <c-form-check variant="checkbox" class="checkbox-condition">
                                        <input cInput type="checkbox" value="option1" id="condition" formControlName="status">
                                    </c-form-check>
                                </c-form-group>
                                <!--                      BULLISH CONDITION NOTE -->
                                <c-form-group cCol sm="5">
                                    <label for="conditionNote">Condition Note</label>
                                    <c-input-group>
                                        <c-input-group-prepend>
                                            <c-input-group-text>
                                                <c-icon name="cil-notes"></c-icon>
                                            </c-input-group-text>
                                        </c-input-group-prepend>
                                        <input cInput id="conditionNote" name="conditionNote1" placeholder="Condition Note" formControlName="statusNote"
                                               [ngClass]="{ 'is-invalid':  (submitted || bullishConditionStatusAt(i).touched) && bullishConditionStatusAt(i).invalid, 'is-valid': bullishConditionStatusAt(i).touched && bullishConditionStatusAt(i).valid }">
                                        <c-input-group-append>
                                            <button cButton color="danger" shape="pill" (click)="deleteBullishCondition(i)">
                                                <c-icon name="cil-delete"></c-icon>
                                            </button>
                                        </c-input-group-append>
                                    </c-input-group>
                                    <div *ngIf="bullishConditionStatusAt(i).touched && bullishConditionStatusAt(i).invalid" class="alert alert-danger">
                                        Condition note is required
                                    </div>
                                </c-form-group>
                            </c-row>
                        </ng-container>
                    </ng-container>

                    <c-col col="md" sm="4" class="mb-3">
                        <button cButton color="info" shape="pill" (click)="addBullishCondition()">
                            <c-icon name="cil-plus"></c-icon>
                            <span>&nbsp;Add</span>
                        </button>
                    </c-col>
                </c-card-body>
            </c-card>
        </c-col>
    </c-row>
    <c-row>
        <c-col sm="12">
            <c-card>
                <c-card-header>
                    <strong>Bearish conditions</strong>
                </c-card-header>
                <c-card-body>
                    <ng-container formArrayName="bearishConditions">
                        <ng-container *ngFor="let bearishConditionItem of bearishConditions.controls; let i = index">
                            <c-row [formGroup]="bearishConditionItem">
                                <!--                       BEARISH CONDITION STATUS;-->
                                <c-form-group cCol sm="1">
                                    <label for="condition1">Status</label>
                                    <c-form-check variant="checkbox" class="checkbox-condition">
                                        <input cInput type="checkbox" value="option1" id="condition1" formControlName="status">
                                    </c-form-check>
                                </c-form-group>
                                <!--                      BEARISH CONDITION NOTE -->
                                <c-form-group cCol sm="5">
                                    <label for="conditionNote1">Condition Note</label>
                                    <c-input-group>
                                        <c-input-group-prepend>
                                            <c-input-group-text>
                                                <c-icon name="cil-notes"></c-icon>
                                            </c-input-group-text>
                                        </c-input-group-prepend>
                                        <input cInput id="conditionNote1" name="conditionNote1" placeholder="Condition Note" formControlName="statusNote"
                                               [ngClass]="{ 'is-invalid':  (submitted || bearishConditionStatusAt(i).touched) && bearishConditionStatusAt(i).invalid, 'is-valid': bearishConditionStatusAt(i).touched && bearishConditionStatusAt(i).valid }">
                                        <c-input-group-append>
                                            <button cButton color="danger" shape="pill" (click)="deleteBearishCondition(i)">
                                                <c-icon name="cil-delete"></c-icon>
                                            </button>
                                        </c-input-group-append>
                                    </c-input-group>
                                    <div *ngIf="bearishConditionStatusAt(i).touched && bearishConditionStatusAt(i).invalid" class="alert alert-danger">
                                        Condition note is required
                                    </div>
                                </c-form-group>
                            </c-row>
                        </ng-container>
                    </ng-container>

                    <c-col col="md" sm="4" class="mb-3">
                        <button cButton color="info" shape="pill" (click)="addBearishCondition()">
                            <c-icon name="cil-plus"></c-icon>
                            <span>&nbsp;Add</span>
                        </button>
                    </c-col>
                </c-card-body>
            </c-card>
        </c-col>
    </c-row>
    <c-row>
        <c-col sm="12">
            <c-card>
                <c-card-header>
                    <strong>Take Profit Inputs</strong>
                </c-card-header>
                <c-card-body>
                    <ng-container formArrayName="takeProfitInputs">
                        <ng-container *ngFor="let takeProfitInputItem of takeProfitInputs.controls; let i = index">
                            <c-row [formGroup]="takeProfitInputItem">
                                <c-form-group cCol sm="3">
                                    <label for="condition1">Price Percent</label>
                                    <c-input-group>
                                        <input cInput id="pricePercent"
                                               name="pricePercent"
                                               placeholder="Price Percent"
                                               formControlName="pricePercent"
                                               type="number"
                                               step="1"
                                               [ngClass]="{ 'is-invalid':  (submitted || takeProfitPricePercentAt(i).touched) && takeProfitPricePercentAt(i).invalid, 'is-valid': takeProfitPricePercentAt(i).touched && takeProfitPricePercentAt(i).valid }">
                                        <c-input-group-append>
                                            <c-input-group-text>%</c-input-group-text>
                                        </c-input-group-append>
                                    </c-input-group>
                                </c-form-group>

                                <c-form-group cCol sm="3">
                                    <label for="condition1">Quantity Percent</label>
                                    <c-input-group>
                                        <input cInput id="quantityPercent"
                                               name="quantityPercent"
                                               placeholder="Quantity Percent"
                                               formControlName="quantityPercent"
                                               type="number"
                                               step="1"
                                               [ngClass]="{ 'is-invalid':  (submitted || takeProfitPricePercentAt(i).touched) && takeProfitPricePercentAt(i).invalid, 'is-valid': takeProfitPricePercentAt(i).touched && takeProfitPricePercentAt(i).valid }">
                                        <c-input-group-append>
                                            <c-input-group-text>%</c-input-group-text>
                                            <button cButton color="danger" shape="pill" (click)="deleteTakeProfitInput(i)">
                                                <c-icon name="cil-delete"></c-icon>
                                            </button>
                                        </c-input-group-append>
                                    </c-input-group>
                                </c-form-group>
                                <div *ngIf="takeProfitPricePercentAt(i).touched && takeProfitPricePercentAt(i).invalid" class="alert alert-danger">
                                    Price and Quantity Percents are required
                                </div>
                            </c-row>
                        </ng-container>
                    </ng-container>

                    <c-col col="md" sm="4" class="mb-3">
                        <button cButton color="info" shape="pill" (click)="addTakeProfitInput()">
                            <c-icon name="cil-plus"></c-icon>
                            <span>&nbsp;Add</span>
                        </button>
                    </c-col>
                </c-card-body>
                <c-card-footer>
                    <button cButton class="mfe-1" color="success" size="sm" [disabled]="!strategyForm.valid" type="submit"><i class="cil-check-circle"></i>
                        Submit
                    </button>
                    {{strategyForm.errors}}
                    <button cButton color="danger" size="sm" type="reset" (click)="strategyForm.reset()"><i class="cil-ban"></i> Reset</button>
                </c-card-footer>
            </c-card>
        </c-col>
    </c-row>
</form>
